type: vertical-stack
grid_options:
  columns: full
cards:
  - type: custom:bubble-card
    card_type: pop-up
    hash: "#camera-front-door"
    button_type: name
    show_icon: false
    modules:
      - frosted_glass
    frosted_glass:
      main_shadow: none
      icon_shadow: none
      blur: 15px
      opacity: 0.6
      icon_background: rgba(255, 255, 255, 0.5)
    styles: |
      .bubble-main-icon {
        color: white !important;
      }
      .is-off .bubble-background,
      .is-unavailable .bubble-background {
        background: rgba(255, 255, 255, 0.35) !important;
      }
      .is-off .bubble-main-icon {
        opacity: 1 !important;
      }
      .bubble-name,
      .bubble_name {
        color: white !important;
      }
      .bubble-state {
        color: white !important;
        opacity: 1 !important;
      }
      .bubble-main-icon-container ha-ripple,
      .bubble-main-icon-container .bubble-icon-feedback-container {
        display: none !important;
      }
      .bubble-main-icon-container {
        background: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        width: auto !important;
        height: auto !important;
        pointer-events: none !important;
      }
      .bubble-pop-up-background {
        background-color: rgba(25, 36, 54, 0.55) !important;
        filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.15),
            0 15px 40px rgba(0, 0, 0, 0.35);
      }
  - type: custom:bubble-card
    card_type: separator
    name: Front Door Camera
    card_layout: large
    rows: "01"
    grid_options:
      columns: full
    sub_button: []
  - square: false
    type: grid
    grid_options:
      columns: full
    cards:
      - type: custom:webrtc-camera-sfenton
        card_id: front-door-popup
        card_mod:
          style: |
            ha-card {
              aspect-ratio: 4 / 3;
              height: auto;
            }
            .fullscreen,
            .screenshot,
            .header,
            .volume,
            .play,
            .pictureinpicture {
              display: none !important;
            }
        streams:
          - url: front_door
            mode: webrtc,webrtc/tcp,mse,hls,mjpeg
            media: video,audio
        ui: true
        digital_ptz:
          mouse_drag_pan: false
          mouse_wheel_zoom: false
          mouse_double_click_zoom: false
          touch_drag_pan: false
          touch_pinch_zoom: false
          touch_tap_drag_zoom: false
          persist: true
        muted: true
        intersection: 0.75
        background: true
    columns: 1
    card_mod:
      style: |
        :host {
          display: grid;
          width: 100%;
          gap: 12px;
          align-items: stretch;
        }
  - type: grid
    columns: 3
    square: false
    card_mod:
      style: |
        ha-card {
          display: flex;
          flex-direction: row;
          justify-content: center;
        }
    cards:
      - type: custom:bubble-card
        card_type: button
        button_type: name
        name: ""
        icon: mdi:camera
        show_state: false
        show_name: false
        modules:
          - frosted_glass
        frosted_glass:
          main_shadow: none
          icon_shadow: none
          blur: 15px
          opacity: 0.6
          icon_background: rgba(255, 255, 255, 0.5)
        button_action:
          tap_action:
            action: fire-dom-event
            event: webrtc-screenshot
            target_id: front-door-popup
        styles: |
          ha-card {
            display: flex !important;
            flex-direction: row !important;
            justify-content: center !important;
          }
          .bubble-button-card-container {
            width: 52px !important;
            height: 52px !important;
          }
          .bubble-background {
            border-radius: 50% !important;
            cursor: pointer !important;
          }
          .bubble-icon-container {
            background-color: rgba(16, 185, 129, 0.18) !important;
            width: 52px !important;
            height: 52px !important;
            margin: 0 !important;
            pointer-events: none !important;
          }
          .bubble-icon {
            color: var(--success-color, #10b981) !important;
          }
          .bubble-name-container {
            display: none !important;
          }
      - type: custom:bubble-card
        card_type: button
        button_type: name
        name: ""
        icon: mdi:volume-off
        show_state: false
        show_name: false
        button_action:
          tap_action:
            action: fire-dom-event
            event: webrtc-toggle-mute
            target_id: front-door-popup
        modules:
          - frosted_glass
        frosted_glass:
          main_shadow: none
          icon_shadow: none
          blur: 15px
          opacity: 0.6
          icon_background: rgba(255, 255, 255, 0.5)
        styles: |
          ha-card {
            display: flex !important;
            flex-direction: row !important;
            justify-content: center !important;
          }
          .bubble-button-card-container {
            width: 52px !important;
            height: 52px !important;
          }
          .bubble-background {
            border-radius: 50% !important;
            cursor: pointer !important;
          }
          .bubble-icon-container {
            background-color: rgba(220, 38, 38, 0.15) !important;
            width: 52px !important;
            height: 52px !important;
            margin: 0 !important;
            position: relative;
            transition: background-color 0.2s ease;
            pointer-events: none !important;
          }
          .bubble-icon {
            color: var(--error-color, #dc2626) !important;
            transition: color 0.2s ease, visibility 0.2s ease;
          }
          .bubble-name-container {
            display: none !important;
          }
        card_mod:
          style: |
            /* Unmuted state (green) - when body has the unmuted class */
            :host-context(body.webrtc-unmuted-front-door-popup) .bubble-icon-container {
              background-color: rgba(16, 185, 129, 0.18) !important;
            }
            :host-context(body.webrtc-unmuted-front-door-popup) .bubble-icon {
              visibility: hidden;
            }
            /* Show volume-high icon when unmuted using ::after on container */
            :host-context(body.webrtc-unmuted-front-door-popup) .bubble-icon-container::after {
              content: '';
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              width: 24px;
              height: 24px;
              background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2310b981' d='M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z'/%3E%3C/svg%3E") center/contain no-repeat;
              pointer-events: none;
            }
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        name: ""
        entity: input_boolean.is_front_door_recording
        show_state: false
        show_name: false
        button_action:
          tap_action:
            action: call-service
            service: script.turn_on
            target:
              entity_id: script.front_door_manual_recording
          hold_action:
            action: none
        modules:
          - frosted_glass
        frosted_glass:
          main_shadow: none
          icon_shadow: none
          blur: 15px
          opacity: 0.6
          icon_background: rgba(255, 255, 255, 0.5)
        styles: |
          ha-card {
            display: flex !important;
            flex-direction: row !important;
            justify-content: center !important;
          }
          .bubble-button-card-container {
            width: 52px !important;
            height: 52px !important;
          }
          .bubble-background {
            border-radius: 50% !important;
            cursor: pointer !important;
          }
          .bubble-icon-container {
            width: 52px !important;
            height: 52px !important;
            margin: 0 !important;
            pointer-events: none !important;
          }
          .bubble-icon {
            color: rgba(220, 38, 38, 0.85) !important;
          }
          .bubble-name-container {
            display: none !important;
          }
          .is-on .bubble-icon-container {
            background-color: rgba(220, 38, 38, 0.75) !important;
          }
          .is-on .bubble-icon {
            color: white !important;
          }
